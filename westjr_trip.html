<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>駅読み込みテスト</title>
</head>
<body>
  <h2 id="result">読み込み中…</h2>

  <script>
    const stationURL = 'https://raw.githubusercontent.com/takaama09/takaama_homepage/station/station.csv';

    // CSVをパースする関数
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const header = lines[0].split(',');
      return lines.slice(1).map(line => {
        const cols = line.split(',');
        const obj = {};
        header.forEach((h, i) => {
          obj[h] = cols[i];
        });
        return obj;
      });
    }

    async function main() {
      // CSV読み込み
      const res = await fetch(stationURL);
      const text = await res.text();
      const stations = parseCSV(text);

      console.log('stations sample:', stations.slice(0, 5));

      // station_g_cd → 駅名（代表）
      const stationGToName = {};
      for (const s of stations) {
        if (!stationGToName[s.station_g_cd]) {
          stationGToName[s.station_g_cd] = s.station_name;
        }
      }

      // 最寄駅（固定：甲南山手）
      const startG = "1160308";

      // ランダム駅
      const allG = Object.keys(stationGToName);
      const goalG = allG[Math.floor(Math.random() * allG.length)];

      const startName = stationGToName[startG];
      const goalName = stationGToName[goalG];

      document.getElementById('result').innerText =
        `最寄駅：${startName}駅\n→ ゴール駅：${goalName}駅`;

      console.log('startG:', startG, startName);
      console.log('goalG:', goalG, goalName);
    }

    main();
  </script>
</body>
</html>
