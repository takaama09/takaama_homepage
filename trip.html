<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ダーツで電車旅行先決定</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  #map { height: 90vh; width: 100%; }
  #dartBtn { padding: 10px 20px; font-size: 16px; margin: 10px; }
</style>
</head>
<body>
<h2>ダーツで電車旅行先を決めよう！</h2>
<button id="dartBtn">ダーツを投げる</button>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// 地図初期化（東京駅付近中心）
const map = L.map('map').setView([35.681, 139.767], 5); 

// OpenStreetMapタイル
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// CSVをGitHubから読み込み
let stations = [];
fetch('https://github.com/takaama09/takaama_homepage/blob/main/station.csv')
  .then(response => response.text())
  .then(data => {
      const rows = data.split('\n').slice(1); // ヘッダを除く
      stations = rows.map(row => {
          const cols = row.split('\t'); // タブ区切り
          return {
              name: cols[2],       // station_name
              lat: parseFloat(cols[11]),
              lon: parseFloat(cols[10])
          };
      }).filter(s => !isNaN(s.lat) && !isNaN(s.lon));
  });

// ダーツボタン
document.getElementById('dartBtn').addEventListener('click', () => {
    if (stations.length === 0) {
        alert('駅データを読み込んでいます。少し待ってください。');
        return;
    }
    // ランダム駅を選択
    const randomStation = stations[Math.floor(Math.random() * stations.length)];

    // マーカー表示
    L.marker([randomStation.lat, randomStation.lon])
      .addTo(map)
      .bindPopup(`<b>${randomStation.name}</b>`).openPopup();

    // 地図を中心に移動
    map.setView([randomStation.lat, randomStation.lon], 12);
});
</script>
</body>
</html>
