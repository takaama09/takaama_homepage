<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ダーツで電車旅行先決定（Full CSV Lazy Load）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  #map { height: 90vh; width: 100%; }
  #dartBtn { padding: 10px 20px; font-size: 16px; margin: 10px; }
</style>
</head>
<body>
<h2>ダーツで電車旅行先を決めよう！！</h2>
<button id="dartBtn">ダーツを投げる</button>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([35.681, 139.767], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// CSV URL（raw形式）
const csvURL = 'https://raw.githubusercontent.com/takaama09/takaama_homepage/main/station.csv';

// ダーツボタン
document.getElementById('dartBtn').addEventListener('click', async () => {
    // クリック時にCSVを読み込む（遅延読み込み）
    const response = await fetch(csvURL);
    const data = await response.text();

    // ヘッダ除去
    const rows = data.split('\n').slice(1);
    const stations = rows.map(row => {
        const cols = row.split('\t'); // タブ区切り
        return {
            name: cols[2],       // station_name
            lat: parseFloat(cols[11]),
            lon: parseFloat(cols[10])
        };
    }).filter(s => !isNaN(s.lat) && !isNaN(s.lon));

    // ランダム駅を選ぶ
    const randomStation = stations[Math.floor(Math.random() * stations.length)];

    // マーカー表示
    L.marker([randomStation.lat, randomStation.lon])
      .addTo(map)
      .bindPopup(`<b>${randomStation.name}</b>`).openPopup();

    // 地図中心を移動
    map.setView([randomStation.lat, randomStation.lon], 12);
});
</script>
</body>
</html>
