<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>たかあましゆんのゲームページ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
      margin: 0;
    }
    h1 {
      text-align: center;
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    #game {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none; /* パスワード成功まで非表示 */
    }
    button {
      padding: 10px;
      margin: 5px;
      font-size: 1.2em;
      border-radius: 5px;
      cursor: pointer;
    }
    #log {
      margin-top: 20px;
      white-space: pre-line;
      background: #eee;
      padding: 10px;
      border-radius: 5px;
      max-height: 300px;
      overflow-y: auto;
    }
    #result {
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
      margin-top: 10px;
    }
    #playAgain {
      display: none;
      margin: 10px auto;
      display: block;
    }
    /* パスワード画面用 */
    #passwordScreen {
      max-width: 300px;
      margin: 50px auto;
      text-align: center;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    #passwordInput {
      width: 80%;
      font-size: 1.5em;
      text-align: center;
      margin-bottom: 10px;
      padding: 5px;
    }
    #keypad button {
      width: 60px;
      height: 60px;
      font-size: 1.5em;
      margin: 5px;
    }
  </style>
</head>
<body>

<h1>たかあましゆんのゲームページ</h1>

<!-- パスワード画面 -->
<div id="passwordScreen">
  <p>ゲームページに入るにはパスワードを入力してください：</p>
  <input type="text" id="passwordInput" readonly>
  <div id="keypad"></div>
  <button id="enterBtn">Enter</button>
  <button id="clearBtn">Clear</button>
</div>

<!-- ゲーム本体 -->
<div id="game">
  <div id="buttons"></div>
  <div id="log"></div>
  <div id="result"></div>
  <button id="playAgain">もう一度遊ぶ</button>
</div>

<script>
  // -------------------------
  // テンキー式パスワード
  // -------------------------
  const PASSWORD = "0000";
  let input = "";

  const passwordInput = document.getElementById("passwordInput");
  const passwordScreen = document.getElementById("passwordScreen");
  const gameDiv = document.getElementById("game");

  // 数字ボタンを生成
  const keypadDiv = document.getElementById("keypad");
  for (let i = 1; i <= 9; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.onclick = () => {
      input += i;
      passwordInput.value = input;
    };
    keypadDiv.appendChild(btn);
  }
  const zeroBtn = document.createElement("button");
  zeroBtn.textContent = 0;
  zeroBtn.onclick = () => {
    input += "0";
    passwordInput.value = input;
  };
  keypadDiv.appendChild(zeroBtn);

  document.getElementById("clearBtn").onclick = () => {
    input = "";
    passwordInput.value = "";
  };

  document.getElementById("enterBtn").onclick = () => {
    if (input === PASSWORD) {
      alert("パスワード認証成功！");
      passwordScreen.style.display = "none";
      gameDiv.style.display = "block";
    } else {
      alert("パスワードが違います");
      input = "";
      passwordInput.value = "";
    }
  };

  // -------------------------
  // ゲームアルゴリズム
  // -------------------------
  const playerChoices = ["自殺", "他殺", "盾", "救出", "リタイア"];
  const aiChoices = ["自殺", "他殺", "盾", "救出"];
  const resultsTable = {
    "自殺,自殺": ["終了", 0, 0],
    "自殺,他殺": ["引き分け", 0, 0],
    "自殺,盾": ["player", 1, 0],
    "自殺,救出": ["ai", 0, 1],
    "他殺,自殺": ["引き分け", 0, 0],
    "他殺,他殺": ["引き分け", 0, 0],
    "他殺,盾": ["ai", 0, 1],
    "他殺,救出": ["player", 1, 0],
    "盾,自殺": ["player", 1, 0],
    "盾,他殺": ["player", 1, 0],
    "盾,盾": ["引き分け", 0, 0],
    "盾,救出": ["引き分け", 0, 0],
    "救出,自殺": ["ai", 0, 1],
    "救出,他殺": ["ai", 0, 1],
    "救出,盾": ["引き分け", 0, 0],
    "救出,救出": ["引き分け", 0, 0],
  };

  let playerPoints = 0;
  let aiPoints = 0;
  let turn = 1;
  let playerRetired = false;

  const logDiv = document.getElementById("log");
  const buttonsDiv = document.getElementById("buttons");

  function log(msg) {
    logDiv.textContent += msg + "\n";
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function aiChooseHand() {
    return aiChoices[Math.floor(Math.random() * aiChoices.length)];
  }

  function playRound(player) {
    if (player === "リタイア") {
      log("あなたはリタイアしました！強制敗北です。");
      aiPoints += 1;
      playerRetired = true;
      endGame();
      return;
    }

    const ai = aiChooseHand();
    log(`--- ターン ${turn} ---`);
    log(`あなたの手: ${player}`);
    log(`相手の手: ${ai}`);

    const [result, playerPoint, aiPoint] = resultsTable[`${player},${ai}`];

    if (result === "引き分け") {
      log("引き分けです！ポイントは変わりません。");
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    } else if (result === "終了") {
      log("両者自殺！ゲーム終了です！");
      endGame();
      return;
    } else if (result === "player") {
      playerPoints += playerPoint;
      log(`自分のやりたいことができました！ポイントGET！`);
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    } else if (result === "ai") {
      aiPoints += aiPoint;
      log(`相手にやられてしまいました！相手にポイントが入ります（；；）得点:`);
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    }

    turn++;
  }

  function resetGame() {
    playerPoints = 0;
    aiPoints = 0;
    turn = 1;
    playerRetired = false;
    logDiv.textContent = "";
    buttonsDiv.querySelectorAll("button").forEach(b => b.disabled = false);
    document.getElementById("result").textContent = "";
    document.getElementById("playAgain").style.display = "none";
    createButtons();
  }

  function endGame() {
    const resDiv = document.getElementById("result");
    if (playerRetired || aiPoints > playerPoints) {
      resDiv.textContent = "最終結果: 残念！相手の勝ち！";
      resDiv.style.color = "red";
    } else if (playerPoints > aiPoints) {
      resDiv.textContent = "最終結果: おめでとう！あなたの勝ち！";
      resDiv.style.color = "green";
    } else {
      resDiv.textContent = "最終結果: 引き分け！";
      resDiv.style.color = "orange";
    }
    buttonsDiv.innerHTML = "";
    document.getElementById("playAgain").style.display = "block";
    document.getElementById("playAgain").onclick = () => resetGame();
  }

  function createButtons() {
    playerChoices.forEach(choice => {
      const btn = document.createElement("button");
      btn.textContent = choice;
      btn.onclick = () => playRound(choice);
      buttonsDiv.appendChild(btn);
    });
  }

  createButtons();
</script>

</body>
</html>
