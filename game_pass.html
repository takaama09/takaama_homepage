<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ゲームページ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    #result { font-size: 24px; font-weight: bold; margin-top: 20px; }
    #playAgain { margin-top: 20px; display: none; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
  <script>
    // 簡易パスワード認証
    const PASSWORD = "1024102410240124";
    let attempts = 0;
    function checkPassword() {
      const input = prompt("ゲームページに入るにはパスワードを入力してください：");
      attempts++;
      if(input === PASSWORD) {
        alert("パスワード認証成功！");
        return;
      } else {
        alert("パスワードが違います。");
        if(attempts >= 3) {
          alert("3回間違えました。トップページに戻ります。");
          window.location.href = "index.html";
        } else {
          checkPassword();
        }
      }
    }

    // ゲームロジック
    const player_choices = ["自殺", "他殺", "盾", "救出", "リタイア"];
    const ai_choices = ["自殺", "他殺", "盾", "救出"];
    const results_table = {
      "自殺,自殺":["終了",0,0],
      "自殺,他殺":["引き分け",0,0],
      "自殺,盾":["player",1,0],
      "自殺,救出":["ai",0,1],
      "他殺,自殺":["引き分け",0,0],
      "他殺,他殺":["引き分け",0,0],
      "他殺,盾":["ai",0,1],
      "他殺,救出":["player",1,0],
      "盾,自殺":["player",1,0],
      "盾,他殺":["player",1,0],
      "盾,盾":["引き分け",0,0],
      "盾,救出":["引き分け",0,0],
      "救出,自殺":["ai",0,1],
      "救出,他殺":["ai",0,1],
      "救出,盾":["引き分け",0,0],
      "救出,救出":["引き分け",0,0]
    };

    let player_points = 0;
    let ai_points = 0;
    let turn = 1;
    let player_retired = false;

    function ai_minimax(player_points, ai_points){
      // 超簡易AI：ランダムで手を選ぶ
      return ai_choices[Math.floor(Math.random()*ai_choices.length)];
    }

    function playRound(player){
      if(player === "リタイア") {
        alert("あなたはリタイアしました。強制敗北です。"); 
        ai_points += 1;
        player_retired = true;
        endGame();
        return;
      }

      // AI手決定（簡略化）
      let ai = ai_minimax(player_points, ai_points);

      alert(`相手の手は: ${ai}`);

      let key = `${player},${ai}`;
      let [result, ai_point, player_point] = results_table[key];

      if(result === "引き分け") {
        alert("引き分けです。ポイントは変わりません。");
      } else if(result === "終了") {
        alert("両者自殺！ゲーム終了です！");
        endGame();
        return;
      } else if(result === "player") {
        player_points += player_point;
        alert(`あなたの勝ち！得点: あなた ${player_point} - コンピュータ ${ai_point} `);
      } else if(result === "ai") {
        ai_points += ai_point;
        alert(`相手の勝ち！得点: あなた ${player_point} - コンピュータ ${ai_point} `);
      }

      turn++;
    }

    function endGame(){
      const resDiv = document.getElementById("result");
      if(player_retired || ai_points > player_points){
        resDiv.textContent = "最終勝利: 相手の勝ち！";
        resDiv.style.color = "blue";
      } else if(player_points > ai_points){
        resDiv.textContent = "最終勝利: あなたの勝ち！";
        resDiv.style.color = "red";
      } else {
        resDiv.textContent = "最終結果: 引き分け！";
        resDiv.style.color = "orange";
      }
      document.getElementById("playAgain").style.display = "block";
      // ボタン押したらページリロード
      document.getElementById("playAgain").onclick = () => location.reload();
    }

    window.onload = checkPassword;
  </script>
</head>
<body>
  <h1>ゲームページ</h1>
  <p>手を選んでください:</p>
  <div id="buttons">
    <button onclick="playRound('自殺')">自殺</button>
    <button onclick="playRound('他殺')">他殺</button>
    <button onclick="playRound('盾')">盾</button>
    <button onclick="playRound('救出')">救出</button>
    <button onclick="playRound('リタイア')">リタイア</button>
  </div>
  <div id="result"></div>
  <button id="playAgain">もう一度遊ぶ</button>
</body>
</html>
