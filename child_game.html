<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>たかあましゆんのゲームページ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
      margin: 0;
    }
    h1 {
      text-align: center;
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    #game {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none; /* パスワード成功まで非表示 */
    }
    button {
      padding: 10px;
      margin: 5px;
      font-size: 1.2em;
      border-radius: 5px;
      cursor: pointer;
    }
    #log {
      margin-top: 20px;
      white-space: pre-line;
      background: #eee;
      padding: 10px;
      border-radius: 5px;
      max-height: 300px;
      overflow-y: auto;
    }
    #result {
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
      margin-top: 10px;
    }
    #playAgain {
      display: none;
      margin: 10px auto;
      display: block;
    }
    /* パスワード画面用 */
    #passwordScreen {
      max-width: 320px;
      margin: 50px auto;
      text-align: center;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    #passwordInput {
      width: 80%;
      font-size: 1.5em;
      text-align: center;
      margin-bottom: 10px;
      padding: 5px;
    }
    #keypad {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-template-rows: repeat(4, 60px);
      gap: 10px;
      justify-content: center;
      margin-bottom: 10px;
    }
    #keypad button {
      width: 60px;
      height: 60px;
      font-size: 1.5em;
    }
    #controlBtns {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 5px;
    }
    #controlBtns button {
      padding: 8px 20px;
      font-size: 1.2em;
    }
    #passwordMessage {
      color: red;
      font-weight: bold;
      margin-top: 10px;
      min-height: 1.2em;
    }
    #attemptMessage {
      color: blue;
      font-weight: bold;
      margin-top: 5px;
      min-height: 1.2em;
    }
  </style>
</head>
<body>

<h1>たかあましゆんのゲームページ</h1>

<!-- パスワード画面 -->
<div id="passwordScreen">
  <p>ゲームページに入るにはパスワードを入力してください：</p>
  <input type="text" id="passwordInput" readonly>
  <div id="keypad"></div>
  <div id="controlBtns">
    <button id="enterBtn">Enter</button>
    <button id="clearBtn">Clear</button>
  </div>
  <p id="passwordMessage"></p>
  <p id="attemptMessage"></p>
</div>

<!-- ゲーム本体 -->
<div id="game">
  
  <!-- ルール説明 -->
  <div id="rules" style="text-align:center; margin-bottom:15px; font-size:1em; line-height:1.4;">
    <p>ゲームのルール：</p>
    <p>・子供の頃を思い出して。</p>
  </div>

  <div id="buttons"></div>
  <div id="log"></div>
  <div id="result"></div>
  <button id="playAgain">もう一度遊ぶ</button>
</div>

<script>
  // -------------------------
  // テンキー式パスワード（0は中央下）
  // -------------------------
  const PASSWORD = "0000";
  let input = "";
  let attemptsLeft = 3;

  const passwordInput = document.getElementById("passwordInput");
  const passwordScreen = document.getElementById("passwordScreen");
  const gameDiv = document.getElementById("game");
  const passwordMessage = document.getElementById("passwordMessage");
  const attemptMessage = document.getElementById("attemptMessage");

  const keypadDiv = document.getElementById("keypad");

  // 1〜9ボタン
  for (let i = 1; i <= 9; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.onclick = () => {
      input += i;
      passwordInput.value = input;
    };
    keypadDiv.appendChild(btn);
  }
  // 空白（左下）
  const emptyBtn1 = document.createElement("div");
  keypadDiv.appendChild(emptyBtn1);
  // 0ボタン（中央下）
  const zeroBtn = document.createElement("button");
  zeroBtn.textContent = 0;
  zeroBtn.onclick = () => {
    input += "0";
    passwordInput.value = input;
  };
  keypadDiv.appendChild(zeroBtn);
  // 空白（右下）
  const emptyBtn2 = document.createElement("div");
  keypadDiv.appendChild(emptyBtn2);

  document.getElementById("clearBtn").onclick = () => {
    input = "";
    passwordInput.value = "";
    passwordMessage.textContent = "";
  };

  document.getElementById("enterBtn").onclick = () => {
    if (input === PASSWORD) {
      passwordScreen.style.display = "none";
      gameDiv.style.display = "block";  
  　　createButtons();
    } else {
      attemptsLeft--;
      passwordMessage.textContent = "パスワードが違います！";
      attemptMessage.textContent = `残り試行回数: ${attemptsLeft}`;
      input = "";
      passwordInput.value = "";
      if (attemptsLeft <= 0) {
        passwordMessage.textContent = "3回間違えました。トップページに戻ります。";
        setTimeout(() => {
          window.location.href = "index.html";
        }, 1500);
      }
    }
  };
  // 初期表示
  attemptMessage.textContent = `残り試行回数: ${attemptsLeft}`;

  // -------------------------
  // ゲームアルゴリズム
  // -------------------------
  const playerChoices = ["溜め", "攻撃", "防御", "ミラー", "貫通", "リタイア"];
  const aiChoices = ["溜め", "攻撃", "防御", "ミラー", "貫通",];
  const resultsTable = {
    "溜め,溜め": ["引き分け", 0, 0],
  };

  let playerPoints = 0;
  let aiPoints = 0;
  let turn = 1;
  let playerRetired = false;

  const logDiv = document.getElementById("log");
  const buttonsDiv = document.getElementById("buttons");

  function log(msg) {
    logDiv.textContent += msg + "\n";
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function aiChooseHand() {
    return aiChoices[Math.floor(Math.random() * aiChoices.length)];
  }

  function playRound(player) {
    if (player === "リタイア") {
      log("あなたはリタイアしました！強制敗北です。");
      aiPoints += 1;
      playerRetired = true;
      endGame();
      return;
    }

    const ai = aiChooseHand();
    log(`--- ターン ${turn} ---`);
    log(`あなたの手: ${player}`);
    log(`相手の手: ${ai}`);

    const [result, playerPoint, aiPoint] = resultsTable[`${player},${ai}`];

    if (result === "引き分け") {
      log("引き分けです！ポイントは変わりません。");
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    } else if (result === "終了") {
      log("両者自殺！ゲーム終了です！");
      endGame();
      return;
    } else if (result === "player") {
      playerPoints += playerPoint;
      log(`自分のやりたいことができました！ポイントGET！`);
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    } else if (result === "ai") {
      aiPoints += aiPoint;
      log(`相手にやられてしまいました！相手にポイントが入ります（；；）得点:`);
      log(`あなた ${playerPoints} - 相手 ${aiPoints}`);
    }

    turn++;
  }

  function resetGame() {
    playerPoints = 0;
    aiPoints = 0;
    turn = 1;
    playerRetired = false;
    logDiv.textContent = "";
    buttonsDiv.querySelectorAll("button").forEach(b => b.disabled = false);
    document.getElementById("result").textContent = "";
    document.getElementById("playAgain").style.display = "none";
    createButtons();
  }

  function endGame() {
    const resDiv = document.getElementById("result");
    if (playerRetired || aiPoints > playerPoints) {
      resDiv.textContent = "最終結果: 残念！相手の勝ち！";
      resDiv.style.color = "red";
    } else if (playerPoints > aiPoints) {
      resDiv.textContent = "最終結果: おめでとう！あなたの勝ち！";
      resDiv.style.color = "green";
    } else {
      resDiv.textContent = "最終結果: 引き分け！";
      resDiv.style.color = "orange";
    }
    buttonsDiv.innerHTML = "";
    document.getElementById("playAgain").style.display = "block";
    document.getElementById("playAgain").onclick = () => resetGame();
  }

  function createButtons() {
    playerChoices.forEach(choice => {
      const btn = document.createElement("button");
      btn.textContent = choice;
      btn.onclick = () => playRound(choice);
      buttonsDiv.appendChild(btn);
    });
  }

</script>

</body>
</html>
