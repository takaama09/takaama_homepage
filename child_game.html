<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>溜め攻撃ゲーム</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; }
  button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  #log { margin-top: 20px; white-space: pre-line; }
</style>
</head>
<body>

<h1>溜め攻撃ゲーム</h1>
<p>溜め、攻撃、防御、反射、貫通の5つのボタンから選んで戦おう！</p>

<div>
  <button onclick="play('溜め')">溜め</button>
  <button onclick="play('攻撃')">攻撃</button>
  <button onclick="play('防御')">防御</button>
  <button onclick="play('反射')">反射</button>
  <button onclick="play('貫通')">貫通</button>
</div>

<div id="status">
  <p>あなたの溜め: <span id="playerCharge">0</span></p>
  <p>相手の溜め: <span id="enemyCharge">0</span></p>
</div>

<div id="log"></div>

<script>
let playerCharge = 0;
let enemyCharge = 0;

function play(playerMove) {
  // AIの動き
  const moves = ['溜め','攻撃','防御','反射','貫通'];
  const enemyMove = moves[Math.floor(Math.random() * moves.length)];

  let log = `あなた: ${playerMove}  |  相手: ${enemyMove}\n`;

  // 溜めの判定
  if (playerMove === '溜め') {
    playerCharge++;
  }
  if (enemyMove === '溜め') {
    enemyCharge++;
  }

  // 勝敗判定関数
  function checkMove(move, charge, oppMove, oppCharge) {
    if (move === '攻撃' && charge < 1) return '無効';
    if (move === '反射' && charge < 3) return '無効';
    if (move === '貫通' && charge < 5) return '無効';
    return '有効';
  }

  const playerValid = checkMove(playerMove, playerCharge, enemyMove, enemyCharge);
  const enemyValid = checkMove(enemyMove, enemyCharge, playerMove, playerCharge);

  // 勝敗処理
  let result = '';

  if (playerValid !== '有効') log += 'あなたの技は溜め不足で無効になった。\n';
  if (enemyValid !== '有効') log += '相手の技は溜め不足で無効になった。\n';

  if (playerValid === '有効') {
    if (playerMove === '攻撃') playerCharge = 0;
    if (playerMove === '反射') playerCharge = 0;
    if (playerMove === '貫通') playerCharge = 0;
  }

  if (enemyValid === '有効') {
    if (enemyMove === '攻撃') enemyCharge = 0;
    if (enemyMove === '反射') enemyCharge = 0;
    if (enemyMove === '貫通') enemyCharge = 0;
  }

  // 勝敗判定ルール
  if (playerValid === '有効' && enemyValid === '有効') {
    // 貫通優先
    if (playerMove === '貫通' && enemyMove !== '貫通') result = 'あなたの勝ち';
    else if (enemyMove === '貫通' && playerMove !== '貫通') result = 'あなたの負け';
    // 攻撃 vs 溜め
    else if (playerMove === '攻撃' && enemyMove === '溜め') result = 'あなたの勝ち';
    else if (enemyMove === '攻撃' && playerMove === '溜め') result = 'あなたの負け';
    // 攻撃 vs 反射
    else if (playerMove === '攻撃' && enemyMove === '反射') result = 'あなたの負け';
    else if (enemyMove === '攻撃' && playerMove === '反射') result = 'あなたの勝ち';
    // 反射は貫通以外反射する
    else if (playerMove === '反射' && enemyMove === '攻撃') result = 'あなたの勝ち';
    else if (enemyMove === '反射' && playerMove === '攻撃') result = 'あなたの負け';
    else result = '何も起きなかった';
  }

  log += result ? `結果: ${result}\n` : '結果: なし\n';

  document.getElementById('log').innerText = log;
  document.getElementById('playerCharge').innerText = playerCharge;
  document.getElementById('enemyCharge').innerText = enemyCharge;
}
</script>

</body>
</html>
